---
# General Information
category: "Web Programming I"
title: "Modules"
created: "2024-09-28"
number: 17
---

# Quick Recap

- What is Node.js? Node.js is a runtime environment that allows you to run JavaScript code on the server
- What is nvm? nvm (Node Version Manager) is a tool that allows you to install, manage, and switch between different versions of Node.js
- What is npm? npm (Node Package Manager) is the default package manager for Node.js
- What is the entry point of a node project? `index.js`
- What is the `package.json`? The `package.json` file contains metadata about the project
- What happens if i delete `node_modules` from my project? How do I get them back? Deleting the `node_modules` folder removes all installed packages. To restore them, run `npm install`

# Common Node.js problems and how to fix them

## Command not found

If you encounter the message:

```text
command not found
```

Here’s how to resolve it:

- Ensure that Node.js is installed properly: Use `node -v` and `npm -v` to verify
- Download [nvm](https://github.com/nvm-sh/nvm) or [node](https://nodejs.org/en)

## Cannot run npm

If you see an error message like:

```text
cannot run scripts on this machine.
```

This might occur if you are using `PowerShell` in Visual Studio Code. To fix this, click the dropdown next to the `+` icon in the upper right corner of your terminal and select the `V` icon. Open either a `bash` or `zsh` terminal.

## Cannot Find Module

If you encounter this problem, it typically means you are trying to access a module that isn't installed. To fix this, run the following command in your project directory, and ensure your `package.json` is updated:

```bash
npm install module_name # but use the actual package name
```

If you still have import issues, your `node_modules` directory may be corrupted. In this case, delete the `node_modules` folder and reinstall the modules:

```bash
rm -rf node_modules # clicking delete is also valid
npm install # fresh node modules 4 u
```

## The engine "node" is incompatible with this module

This error occurs when your current Node.js version does not meet the minimum version requirements specified by a package or dependency. To resolve this, check your `package.json` in the `engines` section:

```json
"engines": {
 "node": ">=14.0.0"
}
```

This indicates the version your project requires. Use `nvm` to switch to the specified version:

```bash
nvm install 14
nvm use 14
```

## Version Conflicts

Sometimes, certain packages may not work with newer versions of Node.js. To address this, use `nvm` to switch to an older version:

```bash
nvm install 12
nvm use 12
```

## npm install takes an eternity

If running `npm install` takes too long or fails due to network issues or dependency problems, you can speed things up by specifying a faster npm registry:

```bash
npm set registry https://registry.npmjs.org/
```

n this context, a registry is a _centralized_ repository for JavaScript packages, whereas a CDN consists of a network of _distributed_ servers that deliver web content, such as jQuery.

# Exercise 1

As an exercise, set up a Node.js project and install `express` and `lodash`. Try to use `lodash` in your `index.js` by referring to the [official docs](https://lodash.com/docs/4.17.15)

## Solution

Your `package.json` should look something like this:

```json
{
  "dependencies": {
    "express": "^4.21.0",
    "lodash": "^4.17.21"
  }
}
```

And your `index.js` should look something like this:

```js
"use strict";

const _ = require("lodash");

const cats = [
  { user: "Charlie", age: 2 },
  { user: "Olive", age: 3 },
  { user: "Bill", age: 2 },
  { user: "Snuffles", age: 10 }, // only one older cat
];

const groupedCats = _.groupBy(cats, "age");

console.log(groupedCats);
```

# Modules

Ok so we learnt how to import other peoples modules, but what happens if we want to make our own?

## Getting Started

Let's say you have some JavaScript code that lives in a single file. You can turn this into a module by exporting it.

This allows other files to use an `import` statement to import this file as a dependency.

## What is a module?

A file that exports some code.

## Why is this so cool?

This allows developers to organize code in their own projects or share the code with the world with package managers `npm`

## How do you export your code?

The way you export the code will impact the way the rest of the code imports it. There are 2 ways to create a custom module:

- ESModules (modern approach) using `import`/`export`
- CommonJS (old school approach) using `require`/`module.exports`

# ESModules

`import` is the newer module system that is now part of the ECMAScript standard and is supported natively by modern browsers and also in newer versions of Node.js. It requires extra setup and works like this:

## Names

Name Export Statement:

```js
export const name = "value";
```

Name Import Statement:

```js
import { name } from "...";
```

## Default

Default Export Statement:

```js
export default "value";
```

Default Import Statement:

```js
import anyName from "...";
```

## Rename

Rename Export Statement:

```js
export { name as newName };
```

Rename Import Statement:

```js
import { newName } from "...";
```

## Lists

List + Rename Export Statement:

```js
export { name1, name2 as newName2 };
```

List + Rename Import Statement:

```js
import { name1 as newName1, newName2 } from "...";
```

# CommonJS

`require` is the older module system, primarily used in older versions of Node.js. By default, Node.js treats files as CommonJS modules and works like this:

# When do I use which method?

- If you’re working in modern JavaScript, particularly for projects that use tools like React, Vue, etc., `import` Modules is the recommended and preferred approach. (e.g. what i do)
- If you are working in older projects, or the projects need to be "backwards compatible", then `require` is the recommended approach

## Do I need to know both?

Yes. You will likely see both approaches throughout your career.

# Modules in Practice

Building on `Exercise 1`, let's create a new subfolder called `utils` where we are going to create our own custom module called `customModule.js`. Your folder structure should look something like this:

```md
node-app
├── node_modules
├── utils
│ ├── customModule.js
├── index.js
├── package-lock.json
├── package.json
```

Now we can begin to develop our own reusable code. Let's start with something simple we probably need to rewrite a lot of in our projects: Text Formatting.

## CommonJS Approach

Inside `customModule.js`, lets add the following changes:

```js
function caps(input) {
  if (!input || typeof input !== "string") {
    return null;
  }
  return input.toUpperCase();
}

module.exports = { caps }; // notice me
```

Now when we head over to `index.js` and we can now import the code with the following:

```js
// notice me
const { caps } = require("./utils/customModule");

console.log(caps("ahhhhhhhhhhhh"));
```

When we run the following command in our terminal:

```bash
node .
```

We should see the following logged to the terminal:

```text
AHHHHHHHHHHHH
```

However let's say we want to use the more modern approach to modules...

## ESModules

First, we need to let Node.js know we plan to take the modern approach by adding the following to our `package.json`

```json
{
  "type": "module", // notice me
  "dependencies": {
    "express": "^4.21.0",
    "lodash": "^4.17.21"
  }
}
```

This tells Node.js to interpret `.js` files as ES modules. Now we can head over to `customModule.js` and export it with the modern convention:

```js
export function caps(input) {
  if (!input || typeof input !== "string") {
    return null;
  }
  return input.toUpperCase();
}
```

And import it in your `index.js` with the following convention:

```js
import { caps } from "./utils/customModule.js";

console.log(caps("ahhhhhhhhhhhh"));
```

To achieve the same functionality as before.

# Common Module problems and how to fix them

## Cannot use import statement outside a module

if you see something close to the following:

```text
import { myModule } from "some/link/to/myModule";
^^^^^^

SyntaxError: Cannot use import statement outside a module
```

This means you need to configure your `package.json` with the following line:

```json
{
  "type": "module" // add me to your package
}
```

## Cannot find module

If you see something close to the following:

```text
Error [ERR_MODULE_NOT_FOUND]: Cannot find module 'node-app/some/link/to/myModule' imported from node-app/index.js
Did you mean to import ../utils/myModule.js?
```

Ensure that the file path you are using in your import statement is correct. If your paths still don't work then ensure your import statement ends with a `.js` like so:

```js
import { myModule } from "./utils/myModule.js"; // notice the extension
```

The extension is necessary for ESmodules in Node.js.

# Modules in the Real world

You can visit my [repo](https://github.com/elizabeth-poggie/elizabeth-poggie/tree/main/src/utils) to check out how I created my own utilities if you are curious :^)

# Exercise 2

In this exercise you are going to create some useful utilities.

First, create the following folder structure:

```md
node-app
├── node_modules
├── utils
│ ├── textFormatters.js
├── index.js
├── package-lock.json
├── package.json
```

Next, make the appropriate changes in your `package.json` to use ESModules and create the following functions in `textFormatters.js`:

- `formatDateShort` that takes a `dateString` as input and formats the date in short form
- `formatDateLong` that takes a `dateString` as input and formats the date in long form

Hint: you can turn the `dateString` into a `Date` object with the following code snippet:

```js
const date = new Date(dateString);
```

And you can read the docs [here](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleDateString) to properly format the object

## Solution

Your `textFormatters.js` should look close to the following:

```js
export function formatDateShort(dateString) {
  const date = new Date(dateString);
  const options = { month: "short", day: "numeric" };
  return date.toLocaleDateString(undefined, options); // Formats to Month Day
}

export function formatDateLong(dateString) {
  const date = new Date(dateString);
  const options = { year: "numeric", month: "long", day: "numeric" };
  return date.toLocaleDateString(undefined, options); // Formats to 'Month Day, Year'
}
```

While your `index.js` should look close to:

```js
import { formatDateShort, formatDateLong } from "./utils/textFormatters.js";

console.log(formatDateShort("2024-09-29"));
console.log(formatDateLong("2024-09-29"));
```
