---
# General Information
category: "Web Programming I"
title: "Modules"
created: "2024-09-28"
number: 17
---

# Quick Recap

- What is Node.js?
- What is nvm?
- What is npm?
- What is the entry point of a node project?
- What is the `package.json`?
- What happens if i delete `node_modules` from my project? How do I get them back?

# Common Node.js problems and how to fix them

## Command not found

You might see the following:

```text
command not found
```

To fix this:

- Ensure that Node.js is installed properly: Use `node -v` and `npm -v` to verify
- Download [nvm](https://github.com/nvm-sh/nvm) or [node](https://nodejs.org/en)

## Cannot run npm

You might get an error message on your machine that contains the following:

```text
cannot run scripts on this machine.
```

In this case, check to see if you are in `powershell` in your VScode. If this is the case, next to the `+` icon on the upper right hand corner of your terminal select the `V` icon and open up either a `bash` or `zsh`

## Cannot Find Module

When you run into this problem it's usually because you are trying to access something that isn't installed.

To fix this, run the below in your project and verify that your `package.json` has been updated to reflect these problems.

```bash
npm install module_name # but use the actual package name
```

If there is still an import problem at this point, your `node_modules` might have become corrupted. delete the `node_modules` directory and run `npm install` to resolve the problem.

```bash
rm -rf node_modules # clicking delete is also valid
npm install # fresh node modules 4 u
```

## The engine "node" is incompatible with this module

This occurs when the version of Node.js you’re using does not meet the minimum version requirements specified by a package or dependency. TO fix this check your `package.json` and look for the following:

```json
"engines": {
 "node": ">=14.0.0"
}
```

This specifies the Node.js version you project expects. Using `nvm` (Node Version Manager) switch to this expected version:

```bash
nvm install 14
nvm use 14
```

## Version Conflicts

Some packages may unfortunately not work with newer versions of Node.js. To fix this, you need `nvm` again to switch to an older version of node:

```bash
nvm install 12
nvm use 12
```

## npm install takes an eternity

Sometimes running `npm install` takes an eternity or fails due to network or dependency issues. To fix this, you can actually specify a faster npm registry:

```bash
npm set registry https://registry.npmjs.org/
```

In the context of npm, a registry is a _centralized_ repository that stores and distributes JavaScript packages. This differs from CDNs which are a network of _distributed_ servers that deliver web content (e.g. jQuery).

# Exercise 1

As an exercise, try setting up a project with node and installing `express` and `lodash`. Try to use `lodash` in your `index.js` by referring to the [official docs](https://lodash.com/docs/4.17.15)

## Solution

Your `package.json` should look something like this:

```json
{
  "dependencies": {
    "express": "^4.21.0",
    "lodash": "^4.17.21"
  }
}
```

And your `index.js` should look something like this:

```js
"use strict";

const _ = require("lodash");

const cats = [
  { user: "Charlie", age: 2 },
  { user: "Olive", age: 3 },
  { user: "Bill", age: 2 },
  { user: "Snuffles", age: 10 }, // only one older cat
];

const groupedCats = _.groupBy(cats, "age");

console.log(groupedCats);
```

# Modules

Ok so we learnt how to import other peoples modules, but what happens if we want to make our own?

## Getting Started

Let's say you have some JavaScript code that lives in a single file. You can turn this into a module by exporting it.

This allows other files to use an `import` statement to import this file as a dependency.

## What is a module?

A file that exports some code.

## Why is this so cool?

This allows developers to organize code in their own projects or share the code with the world with package managers `npm`

## How do you export your code?

The way you export the code will impact the way the rest of the code imports it. There are 2 ways to create a custom module:

- ESModules (modern approach) using `import`/`export`
- CommonJS (old school approach) using `require`/`module.exports`

# ESModules

`import` is the newer module system that is now part of the ECMAScript standard and is supported natively by modern browsers and also in newer versions of Node.js. It requires extra setup and works like this:

## Names

Name Export Statement:

```js
export const name = "value";
```

Name Import Statement:

```js
import { name } from "...";
```

## Default

Default Export Statement:

```js
export default "value";
```

Default Import Statement:

```js
import anyName from "...";
```

## Rename

Rename Export Statement:

```js
export { name as newName };
```

Rename Import Statement:

```js
import { newName } from "...";
```

## Lists

List + Rename Export Statement:

```js
export { name1, name2 as newName2 };
```

List + Rename Import Statement:

```js
import { name1 as newName1, newName2 } from "...";
```

# CommonJS

`require` is the older module system, primarily used in older versions of Node.js. By default, Node.js treats files as CommonJS modules and works like this:

##

# When do I use which method?

- If you’re working in modern JavaScript, particularly for projects that use tools like React, Vue, etc., `import` Modules is the recommended and preferred approach. (e.g. what i do)
- If you are working in older projects, or the projects need to be "backwards compatible", then `require` is the recommended approach

## Do I need to know both?

Yes. You will likely see both approaches throughout your career.

# Modules in Practice

Building on `Exercise 1`, let's create a new subfolder called `utils` where we are going to create our own custom module called `customModule.js`. Your folder structure should look something like this:

```md
node-app
├── node_modules
├── utils
│ ├── customModule.js
├── index.js
├── package-lock.json
├── package.json
```

Now we can begin to develop our own reusable code. Let's start with something simple we probably need to rewrite a lot of in our projects: Text Formatting.

## CommonJS Approach

Inside `customModule.js`, lets add the following changes:

```js
function caps(input) {
  if (!input || !typeof string) {
    return null;
  }
  return input.toUpperCase();
}

module.exports = { caps }; // notice me
```

Now when we head over to `index.js` and we can now import the code with the following:

```js
// notice me
const { caps } = require("./utils/customModule");

console.log(caps("ahhhhhhhhhhhh"));
```

When we run the following command in our terminal:

```bash
node .
```

We should see the following logged to the terminal:

```text
AHHHHHHHHHHHH
```

However let's say we want to use the more modern approach to modules, let's get started:

##

# Modules in the Real world

# Exercise 2
