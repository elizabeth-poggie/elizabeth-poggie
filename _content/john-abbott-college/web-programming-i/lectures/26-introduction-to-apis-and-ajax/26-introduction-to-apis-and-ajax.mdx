---
# General Information
category: "Web Programming I"
title: "Intro to APIs and AJAX"
created: "2024-10-25"
number: 26
---

# Quick Recap

## How can the UI stay responsive while handling server requests, lazy loading images, and more?

Thanks to the browser's event loop and asynchronous processing, background tasks run without blocking user interactions. This is also why JavaScript doesnâ€™t always run in a predictable order :^)

## What is AJAX?

AJAX (Asynchronous JavaScript and XML) allows web pages to fetch server data and update content without reloading the page

## How do reducers work in JavaScript?

Refer to the previous lecture for a detailed explanation, however please see attached a really cool `gif` that covers the concept well:

![cool reducer](./assets/reduce.gif)

# Intro to APIs

In todayâ€™s connected world, we rely on instant access to just about everything, whether itâ€™s products, knowledge, or services. If I want any product, I can have it delivered to my doorstep within 24 hours thanks to Amazon. If I want to learn something about web development, chances are that some dude on Youtube has already posted a tutorial about it.

In a lot of ways, everything I want, I can get almost instantaneously.

## How does this happen?

How does data get from here to there? How does it move across systems, from me to you, or from one device to another?

![demo](./assets/1.png)

The unseen force behind this seamless exchange is the Application Programming Interface, or API for short:

![demo](./assets/2.png)

## What is an API?

An API is like a messenger: it takes a request, tells a system what you want, and returns a response.

## Conceptual Example

Think of an API like a waiter at a restaurant.

![demo](./assets/3.png)

Picture yourself at a restaurant with a menu of choices and a kitchen where orders are prepared.

![demo](./assets/4.png)

Whatâ€™s missing? A link that communicates your order to the kitchen and brings the food back to your table. Thatâ€™s where the waiter comes in.

![demo](./assets/5.png)

The waiter is the messenger that takes your order (request), tells the kitchen (system) what to prepare, and then brings the completed dish (response) back to you.

![demo](./assets/6.png)

## Real World Example

Letâ€™s take a look at the [Pokemon API](https://pokeapi.co/)

Similar to ordering from a menu, you can choose what information you want from the API by referencing the available options in the [docs](https://pokeapi.co/docs/v2)

Any useful API in the modern age uses detailed documentation that explains each of the endpoints.

Now, open [Postman](https://www.postman.com/) (or [Download it here](https://www.postman.com/downloads/)). If you don't already have an account, create one. If you can't download the Desktop App on the schools computer, use the [web interface](https://web.postman.co/) instead :)

In this example, Postman works like the tablet waiters give you at those unlimited sushi restaurants. Itâ€™s a tool that lets you communicate what you want, just like telling the waiterâ€”or in this case, the APIâ€”your order.

To get started, letâ€™s create a "Pokemon Collection" and add a "New Request." Using Postman, weâ€™ll send a simple "GET" request to call the API and retrieve my favorite Pokemon:

```text
https://pokeapi.co/api/v2/pokemon/ditto
```

What is this response type anyways? Why is the default response `JSON`?

# JSON Data

## What is it?

JSON (JavaScript Object Notation) is a lightweight format for representing structured data.

## Why is the default response JSON?

APIs return JSON data because it works really well with JavaScript, making it ideal for web applications.

## Syntax

Itâ€™s organized using key-value pairs and arrays much like the JavaScript object. However, JSON is language-independent despite looking REALLY similar to JavaScript object syntax:

```JSON
{
    "abilities": [
        {
            "ability": {
                "name": "limber",
                "url": "https://pokeapi.co/api/v2/ability/7/"
            },
            "is_hidden": false,
            "slot": 1
        },
        {
            "ability": {
                "name": "imposter",
                "url": "https://pokeapi.co/api/v2/ability/150/"
            },
            "is_hidden": true,
            "slot": 3
        }
    ]
}
```

Conveniently, if I store this JSON data in a JavaScript variable called `ditto`, I can access its properties like this:

```js
ditto.abilities.forEach((ability) => console.log(ability.ability.name));
```

Notice when i hover over any of the properties, VScode will tell you what exactly you are working with to make your life easier

# Exercise 1

Now it's your turn. Setup postman, and use the Pokemon API to fetch information on your favorite Pokemon :^)

# Account Required APIs

The Pokemon API is a good example of an API that does not require you to create an account or pay for accessing the API. However for most API's, that's not actually the case.

## Api Keys

API keys are unique identifiers used to authenticate requests to an application programming interface (API). They act as a kind of "password" that allows the server to know who is making a request and whether they have permission to access certain data or features.

## ChatGPT

Because I pay for ChatGPT, I am able to make a request with its API to it's fancier models:

```text
https://api.openai.com/v1/chat/completions
```

My request also needs to include:

- Authorization => The API key associated with my paid account
- And a body object => this is the JSON request I am sending to the API using Postman

A sample request would be something like:

```JSON
{
    "id": "chatcmpl-AMEx2bmOQTgeUDHCQ6wLXYz1gNpg0",
    "object": "chat.completion",
    "created": 1729864052,
    "model": "gpt-4-0613",
    "choices": [
        {
            "index": 0,
            "message": {
                "role": "assistant",
                "content": "Hello! How can I assist you today?",
                "refusal": null
            },
            "logprobs": null,
            "finish_reason": "stop"
        }
    ],
    "usage": {
        "prompt_tokens": 13,
        "completion_tokens": 9,
        "total_tokens": 22,
        "prompt_tokens_details": {
            "cached_tokens": 0
        },
        "completion_tokens_details": {
            "reasoning_tokens": 0
        }
    },
    "system_fingerprint": null
}
```

What do all these key, values mean, I invite you to look deeper into the [docs](https://platform.openai.com/docs/overview)

# Intro to AJAX

Now that we've learned how to interact with APIs using Postman, letâ€™s move on to handling API requests directly in JavaScript.

## AJAX requests

AJAX requests allow us to interact with APIs to `fetch` or `send` data without requiring a full page refresh. This is commonly used in web applications and you will inevitably see it in your career.

## Using XMLHttpRequest

`XMLHttpRequest` was the original way to send asynchronous requests from JavaScript. Though itâ€™s a bit more complex, it provides a good understanding of the underlying mechanisms of AJAX.

```js
// Step 1 ðŸ‘‰ create the object
const xhr = new XMLHttpRequest();

// Step 2 ðŸ‘‰ Init the request
xhr.open("GET", "https://pokeapi.co/api/v2/pokemon/ditto", true);

let data;

// Step 3 ðŸ‘‰ Define the function that will run when the request is completed
xhr.onload = function () {
  // Step 4 ðŸ‘‰ check if response is not trash
  if (xhr.status === 200) {
    // Step 5 ðŸ‘‰ Read JSON
    data = JSON.parse(xhr.responseText);
    // Step 6 ðŸ‘‰ print data
    console.log(data);
  } else {
    // handle if request is trash
    console.error("Request is trash with status:", xhr.status);
  }
};

// more error handling
xhr.onerror = function () {
  console.error("WHAT IS THIS TRASH?????");
};

// Step 7 ðŸ‘‰ Send to the API
xhr.send();
```

What's happening with the syntax:

- `open()` prepares a request to an API endpoint.
- `onload` processes the response if successful, and `onerror` handles failures.
- `send()` sends the request.

Why am I logging the data inside the `onload`?

- If you add a `console.log(data);` statement at the end of everything, it will run before the AJAX request completes, which is why it will print `undefined`. Console.log() is prioritized by the event loop whereas server / api requests are "micro" async tasks.

## Using fetch

The fetch API is a modern alternative to XMLHttpRequest that simplifies the syntax for handling AJAX requests. It is promise-based, making it more intuitive to work with asynchronous data.

```js
// Step 1 ðŸ‘‰ Init a fetch request
fetch("https://pokeapi.co/api/v2/pokemon/ditto")
  // Step 2 ðŸ‘‰ Handle the response once retrieved
  .then((response) => {
    // Step 3 ðŸ‘‰ is the response NOT trash?
    if (!response.ok) {
      // Step 4 ðŸ‘‰ yeet error if trash
      throw new Error("TRASHHHHHHHHH: " + response.statusText);
    }
    // Step 5 ðŸ‘‰ parse JSON if not trash
    return response.json();
  })
  // Step 6 ðŸ‘‰ now handle JSON
  .then((data) => console.log(data))
  // Always good to add error handling
  .catch((error) => console.error("Please observe the trash:", error));
```

With `fetch`, data handling is a bit more straight forward:

- The `.then()` blocks handle success and parse the JSON response.
- `.catch()` manages errors, making the code easier to follow and debug.

# Exercise 2

Get into groups of up to 4 people, if you prefer to work independently that's ok too. For this exercise, use the PokÃ©mon API to `fetch` information about your favorite PokÃ©mon.

Using your knowledge of dynamically adding elements to a webpage, ensure that the PokÃ©mon's stats are displayed as soon as the page loads. (use the code from your assignment 2)

## Solution-ish

There are many right answers to this problem. Here is one solution:

```js
// script.js

// Add an event listener to the button
document.getElementById("fetch-button").addEventListener("click", () => {
  // get the pokemon name
  const pokemonName = document
    .getElementById("pokemon-input")
    .value.toLowerCase();
  // pass it to the API fetcher
  fetchPokemonData(pokemonName);
});

// create a fetcher
function fetchPokemonData(name) {
  const url = `https://pokeapi.co/api/v2/pokemon/${name}`;

  fetch(url)
    // handle the response appropriately
    .then((response) => {
      if (!response.ok) {
        throw new Error(`PokÃ©mon not found: ${name}`);
      }
      return response.json();
    })
    // display data if all is well
    .then((data) => {
      displayPokemonStats(data);
    })
    // catch errors if things are trash
    .catch((error) => {
      document.getElementById(
        "pokemon-stats"
      ).innerHTML = `<p>${error.message}</p>`;
    });
}

function displayPokemonStats(pokemon) {
  const statsDiv = document.getElementById("pokemon-stats");
  statsDiv.innerHTML = `
        <h2>${pokemon.name.toUpperCase()}</h2>
        <img src="${pokemon.sprites.front_default}" alt="${pokemon.name}" />
        <h3>Stats:</h3>
        <ul>
            ${pokemon.stats
              .map((stat) => `<li>${stat.stat.name}: ${stat.base_stat}</li>`)
              .join("")}
        </ul>
    `;
}
```
