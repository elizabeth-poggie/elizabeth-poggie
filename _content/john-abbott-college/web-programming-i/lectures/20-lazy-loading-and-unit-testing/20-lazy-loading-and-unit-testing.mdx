---
# General Information
category: "Web Programming I"
title: "Unit Testing"
created: "2024-10-07"
number: 20
---

# Quick Recap

Let's go over step by step on how to create our own static photo server

## Exercise 2 - Last Class

Set up a server using `http-server` with `index.html` as the entry point. Find 3 hi-res images from the internet and save them in your `public` folder.

Next, measure how long it takes to load your page when using `loading="lazy"` on the images. What happens when you remove this attribute? Test the loading time when you simulate a _Slow 4G_ connection using Chrome DevTools.

## Solution

Your folder structure should look like this:

```md
myServer
â”œâ”€â”€ public
â”‚ â”œâ”€â”€ image1
â”‚ â”œâ”€â”€ image2
â”‚ â”œâ”€â”€ image3
â”œâ”€â”€ node_modules
â”œâ”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
```

Your package.json should look like this:

```JSON
{
  "scripts": {
    "start": "http-server"
  },
  "dependencies": {
    "http-server": "^14.1.1"
  }
}
```

In your `index.html`, include the following code:

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cool Cats</title>
  </head>
  <body>
    <img src="./public/image1.jpg" loading="lazy" />
    <img src="./public/image2.jpg" loading="lazy" />
    <img src="./public/image3.jpg" loading="lazy" />
  </body>
</html>
```

Then by navigating to the `Network` Tab, look for your `localhost` and take note of the load time in each scenario. You will have to _Disable Cache_ to see the different load times.

# Unit Testing

## Why Care?

In industry, for every feature you develop, you will also be required to make your own unit tests to guarantee your feature's

## Which Framework?

For this class we are going to use [Jest](https://jestjs.io/), a powerful and widely used testing library.

Jest is actually made by Facebook and many people confuse it as a React Testing Library. It in fact can test ANY JavaScript including code in a React, Angular, and Vue application.

## What makes Jest neat?

Ity runs your tests but it also lets you do a whole bunch of other neat things like:

- Snapshot testing - Takes snapshots of your HTML
- Coverage - has built in code coverage reports. It will let you know which edge cases you missed.
- Mocking - has a built in mocking library that lets you mock any objects outside your test's scope
- Documentation - They have amazing docs
- Speed - it runs VERY quickly

TLDR: It tests your code and it does it well.

# Getting Started

Let's create a new project and install Jest as a development dependency:

```bash
npm install --save-dev jest # notice the flag
```

Now configure your `package.json` with a new `test` script:

```JSON
// package.json
{
  "scripts": {
    "test": "jest"
  }
  // other stuff
}
```

# Creating Tests

Create a folder called `tests` in the root of your project.

```md
myServer
â”œâ”€â”€ tests
â”œâ”€â”€ ...
```

Now inside this folder, create a test file `demo.test.js`.

```js
// demo.test.js

describe("Math operations", () => {
  it("should add 1 + 1", () => {
    expect(1 + 1).toBe(2);
  });
});
```

Notice the `describe` and `it` syntax above, what do these keywords mean?

- `describe` ðŸ‘‰ defines a test suite (e.g. Math operations, Assignment1, Assignment2, etc.)
- `it` ðŸ‘‰ defines a test case (e.g. add, subtract, checkWinner, validateForm, etc. )

# Running Tests

Simply run

```bash
npm test
```

Jest will automatically find your test files (like `demo.test.js`) and run ALL the tests defined in them. You should see something like this printed to console if all is well:

```bash
myDemoServer % npm test

> test
> jest

 PASS  tests/demo.test.js
  Math operations
    âœ“ should add 1 + 1 (1 ms)

Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        0.304 s
Ran all test suites.
```

## Troubleshooting

If for whatever reason your stuff fails at this point, you are probably currently using a version of node lower than 14. If that's the case, switch your node version:

```bash
nvm use 20
```

# Expanding our Example

Let's say we wanted to expand our Test suit to cover more math operations. What could be some examples?

```js
// demo.test.js

describe("Math operations", () => {
  describe("Math operations", () => {
    // equals
    it("should add 1 + 1", () => {
      expect(1 + 1).toBe(2);
    });

    // not equals
    it("should multiply 2 * 3", () => {
      expect(2 * 3).not.toBe(7);
    });

    // this should fail
    it("should subtract 2 - 1", () => {
      expect(2 - 1).toBe(42);
    });
  });
});
```

If any of your tests fails, you will notice that it let's you know the exact line that is causing failure.

# Jest Autocompletion

To enable auto-completion for Jest in your code editor, you can configure your editor to recognize Jest's methods. To get started, first install types for Jest:

```bash
npm install @types/jest --save-dev
```

Add `jsconfig.json` in your root directory:

```md
myServer
â”œâ”€â”€ ...
â”œâ”€â”€ jsconfig.json
â”œâ”€â”€ ...
```

And add the following JSON:

```js
{
  "compilerOptions": {
    "target": "es6",
    "module": "commonjs",
    "checkJs": true,
    "baseUrl": ".",
    "paths": {
      "jest": ["node_modules/jest"]
    }
  },
  "exclude": ["node_modules"]
}
```

Now when you go to write a test case, you will get the lovely autocompletion after you add a `.` after `expect` :^)

```js
expect("stuff").
```

# Downloading VSCode Extensions

## Jest Essentials

There is a [Jest extension for VS Code](https://marketplace.visualstudio.com/items?itemName=firsttris.vscode-jest-runner) that adds additional features, including inline test results and better integration with the editor.

## JavaScript Essentials

[Quokka.js](https://marketplace.visualstudio.com/items?itemName=WallabyJs.quokka-vscode) adds real-time feedback and displays JavaScript code's output inline within your editor. It has a bunch of neat features such as:

- Inline Execution Output
- Live Code Coverage
- Error Highlighting

## Restart

Once you have added the above Extensions, restart your editor to activate them.

# Using VsCode Extensions

## Jest

Above all your test cases (those written with `it`) and test suits (those written with `describe`) you will notice the following above each:

```md
Run | Debug
```

Select either one, what happens?
