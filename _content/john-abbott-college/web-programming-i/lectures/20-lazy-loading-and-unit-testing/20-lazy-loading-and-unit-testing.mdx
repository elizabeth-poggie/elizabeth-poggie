---
# General Information
category: "Web Programming I"
title: "Unit Testing"
created: "2024-10-07"
number: 20
---

# Quick Recap

Letâ€™s review the steps to create your own static photo server.

## Exercise 2 - Last Class

Set up a server using `http-server` with `index.html` as the entry point. Find 3 high-res images and save them in your `public` folder.

Next, measure how long it takes to load your page when using `loading="lazy"` on the images. Remove this attribute and observe the changes.

## Solution

Your folder structure should look like this:

```md
myServer
â”œâ”€â”€ public
â”‚ â”œâ”€â”€ image1
â”‚ â”œâ”€â”€ image2
â”‚ â”œâ”€â”€ image3
â”œâ”€â”€ node_modules
â”œâ”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
```

Your `package.json` should look like this:

```JSON
{
  "scripts": {
    "start": "http-server"
  },
  "dependencies": {
    "http-server": "^14.1.1"
  }
}
```

In your `index.html`, use this code:

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cool Cats</title>
  </head>
  <body>
    <img src="./public/1.jpg" loading="lazy" />
    <img src="./public/2.jpg" loading="lazy" />
    <img src="./public/3.jpg" loading="lazy" />
  </body>
</html>
```

After setting this up, navigate to the `Network` tab in your browserâ€™s developer tools. Look for your `localhost` and note the loading times in each scenario. Remember to _Disable Cache_ to observe the different loading times.

# Unit Testing

## Why Care?

In the industry, for every feature you develop, you are also required to write corresponding unit tests. This basically ensures that your work isn't trash.

## Which Library should you use?

For this class, we will use [Jest](https://jestjs.io/), a powerful and popular testing library.

Although Jest was developed by Facebook and is often associated with React, it can test ANY JavaScript code, including applications built with Angular and Vue.

## What makes Jest neat?

Jest does more than just run your tests; it offers a variety of valuable features, including:

- Snapshot Testing ðŸ‘‰ Automatically captures snapshots of your HTML to track changes.
- Coverage Reports ðŸ‘‰ Provides built-in code coverage reports to highlight any edge cases you may have missed.
- Mocking Capabilities ðŸ‘‰ Includes a built-in mocking library that allows you to simulate objects outside your test's scope.
- Docs ðŸ‘‰ Jest has comprehensive and user-friendly documentation.
- Speed ðŸ‘‰ Jest runs tests incredibly quickly and the process is even faster when you add the VSCode extensions :^)

TLDR: Jest tests your code and it does it well.

# Getting Started

Let's create a new project and install Jest as a development dependency:

```bash
npm install --save-dev jest # notice the flag
```

Now configure your `package.json` with a new `test` script:

```JSON
// package.json
{
  "scripts": {
    "test": "jest"
  }
  // other stuff
}
```

# Creating Tests

Create a folder called `tests` in the root of your project.

```md
myServer
â”œâ”€â”€ tests
â”œâ”€â”€ ...
```

Now inside this folder, create a test file `demo.test.js`.

```js
// demo.test.js

describe("Math operations", () => {
  it("should add 1 + 1", () => {
    expect(1 + 1).toBe(2);
  });
});
```

Notice the `describe` and `it` syntax above, what do these keywords mean?

- `describe` ðŸ‘‰ defines a test suite (e.g. Math operations, Assignment1, Assignment2, etc.)
- `it` ðŸ‘‰ defines a test case (e.g. add, subtract, checkWinner, validateForm, etc. )

# Running Tests

Simply run

```bash
npm test
```

Jest will automatically find your test files (like `demo.test.js`) and run ALL the tests defined in them. You should see something like this printed to console if all is well:

```bash
myDemoServer % npm test

> test
> jest

 PASS  tests/demo.test.js
  Math operations
    âœ“ should add 1 + 1 (1 ms)

Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        0.304 s
Ran all test suites.
```

## Troubleshooting

If for whatever reason your stuff fails at this point, you are probably currently using a version of node lower than 14. If that's the case, switch your node version:

```bash
nvm use 20
```

# Expanding our Example

Let's say we wanted to expand our Test suit to cover more math operations. What could be some examples?

```js
// demo.test.js

describe("Math operations", () => {
  describe("Math operations", () => {
    // equals
    it("should add 1 + 1", () => {
      expect(1 + 1).toBe(2);
    });

    // not equals
    it("should multiply 2 * 3", () => {
      expect(2 * 3).not.toBe(7);
    });

    // this should fail
    it("should subtract 2 - 1", () => {
      expect(2 - 1).toBe(42);
    });
  });
});
```

If any of your tests fails, you will notice that it let's you know the exact line that is causing failure.

# Jest Autocompletion

To enable auto-completion for Jest in your code editor, you can configure your editor to recognize Jest's methods. To get started, first install types for Jest:

```bash
npm install @types/jest --save-dev
```

Add `jsconfig.json` in your root directory:

```md
myServer
â”œâ”€â”€ ...
â”œâ”€â”€ jsconfig.json
â”œâ”€â”€ ...
```

And add the following JSON:

```js
{
  "compilerOptions": {
    "target": "es6",
    "module": "commonjs",
    "checkJs": true,
    "baseUrl": ".",
    "paths": {
      "jest": ["node_modules/jest"]
    }
  },
  "exclude": ["node_modules"]
}
```

Now when you go to write a test case, you will get the lovely autocompletion after you add a `.` after `expect` :^)

```js
expect("stuff").
```

# Downloading VSCode Extensions

## Jest Essentials

There is a [Jest extension for VS Code](https://marketplace.visualstudio.com/items?itemName=firsttris.vscode-jest-runner) that adds additional features, including inline test results and better integration with the editor. Why is this so handy?

- User Friendly ðŸ‘‰ Testing is now as easy as clicking a button
- Speed ðŸ‘‰ In industry your `.test.js` will become long and beefy so normally you don't want to waste time running the entire test suite with `npm test` and want to target specific tests.

## JavaScript Essentials

[Quokka.js](https://marketplace.visualstudio.com/items?itemName=WallabyJs.quokka-vscode) adds real-time feedback and displays JavaScript code's output inline within your editor. It has a bunch of neat features such as:

- Inline Execution Output
- Live Code Coverage
- Error Highlighting

## Restart

Once you have added the above Extensions, restart your editor to activate them.

# Using VsCode Extensions

## Jest

Above all your test cases (those written with `it`) and test suits (those written with `describe`) you will notice the following above each:

```md
Run | Debug
```

Select one, what happens?

## Quokka.js

To get started, create a blank JavaScript file. Now to activate `Quokka.js` press `Ctrl+Shift+P` for windows ðŸ–¥ï¸, or `Cmd+Shift+P` on Mac ðŸŽ to open the command palette.

Search for and select `Quokka.js: Start on Current File`

What happens when i write?

```js
const demo = "demo";
console.log(demo);
```

Happy coding :^)

## Exercise 1

Take your `Assignment1` code and move the `checkWinner()` function to a solitary `cookieCompetition.js` file. Now create a test suite for your `cookieCompetition.js` and create a test case that tests your `checkWinner` function using Jest.

Add the above extensions, how does this make your life easier?

## Solution

Your `cookieCompetition.js` should look something close to this:

```js
function checkWinner(player1, player2) {
  let player1Total = player1.startingCookies;
  player1.cookiesPerRound.forEach(function (cookies) {
    player1Total += cookies;
  });

  let player2Total = player2.startingCookies;
  player2.cookiesPerRound.forEach(function (cookies) {
    player2Total += cookies;
  });

  if (player1Total > player2Total) {
    return `${player1.name} Wins!`;
  } else if (player1Total < player2Total) {
    return `${player2.name} Wins!`;
  } else {
    return "it's a tie!";
  }
}

module.exports = { checkWinner }; // notice me
```

Your `cookieCompetition.test.js` should look close to this:

```js
// cookieCompetition.test.js
const { checkWinner } = require("../scripts/cookieCompetition");

describe("Assignment 1", () => {
  it("check winner - returns player1 as the winner", () => {
    const player1 = {
      name: "Jim",
      startingCookies: 10,
      cookiesPerRound: [5, 8, 7],
    };
    const player2 = {
      name: "Pam",
      startingCookies: 15,
      cookiesPerRound: [4, 4, 4],
    };

    expect(checkWinner(player1, player2)).toBe("Jim Wins!");
  });
});
```
