---
# General Information
category: "Web Programming I"
title: "Your first webserver"
created: "2024-10-03"
number: 19
---

# Creating your own webserver

Today we are going to take our Lazy Loading knowledge to the next level

## Getting started

Create an empty Node.js project with an entry point `index.js`

```md
myServer
â”œâ”€â”€ index.js
```

## Importing the Modules

In your `index.js` import the required modules to create a basic server:

```js
const http = require("http");
const fs = require("fs");
```

In Node.js, `fs` and `http` are "core modules", which means they come pre-installed with Node.js and do not need to be included in your `package.json` as dependencies. What does this mean for you? You don't need to `npm install` these guys.

## Why these Modules?

- http ðŸ‘‰ Provides functionality to create and manage HTTP servers
- fs ðŸ‘‰ Provides functions for interacting with the file system

Fun fact: I use `fs` to fetch [this very note](https://github.com/elizabeth-poggie/elizabeth-poggie/blob/main/src/utils/helpers/noteFetchers.ts#L1) :^)

## Creating a Server

Shockingly, all you need to do to create a server using `http` is as follows:

```js
http.createServer(function (req, res) {
  // other stuff
});
```

This function runs every time the server receives a request, with `req` representing the request and `res` representing the response. Some examples include:

- `req` options: "GET", "POST"
- `res` options: "200 OK", "404 Not Found"

## Reading Files

Now that the skeleton of the server is set up, try to read a file:

```js
fs.readFile("demo.html", "utf8", function (err, data) {
  // other stuff
});
```

- `err` is an error object.
- `data` is the content of the file.

## Sending a Response

If the file is successfully read, the server responds with a status code of `200` and it successfully fetched the contents from the server. If all is well, we now write the data (HTML content) to the response

```js
res.writeHead(200, { "Content-Type": "text/html" });
res.write(data);
return res.end();
```

## Listening on a project

Finally, the server is set to `listen` on port `5555`. This means you can access the server by navigating to http://localhost:5555 in your browser.

```js
http
  .createServer(function (req, res) {
    // other stuff
  })
  .listen(5555);
```

## Running our server

To start our server, simply type the following:

```bash
node .
```

Now when we navigate to our server on port `5555`, we will be able to see the contents of `demo.html` as it's being "served" up.

## All Together

```js
const http = require("http");
const fs = require("fs");

http
  .createServer(function (req, res) {
    fs.readFile("demo.html", function (err, data) {
      res.writeHead(200, { "Content-Type": "text/html" });
      res.write(data);
      return res.end();
    });
  })
  .listen(5555);
```

# Exercise 1

As an exercise, try to set up a server in groups that serves a webpage on port `4242`

## Solution

```js
// index.js
const http = require("http");
const fs = require("fs");

http
  .createServer(function (req, res) {
    fs.readFile("my-cool-server.html", function (err, data) {
      res.writeHead(200, { "Content-Type": "text/html" });
      res.write(data);
      return res.end();
    });
  })
  .listen(4242);
```

# Fancier Servers

Instead of using the default `http` server, let's use `http-server` instead. This is a simple, lightweight, and zero-configuration command-line tool for serving static files over HTTP.

## Why use http-server?

Since we can serve "static" content with this, we can simply start our project with an `index.html`. Why is this handy? Well now we can incorporate cool stuff like `jquery` into our projects :^)

As well, you can now share your local server with others on the same network by providing your [public IP address](https://www.ipchicken.com/), port number, and configuring your firewall to accept incoming requests on this port. HOWEVER, maybe don't make your local IP address accessible to the world cause that would be like posting your phone number on instagram.

Do you want to get harassed? Absolutely not.

What people don't know cannot be exploited :^)

## Getting Started

Install the dependency using `npm` if you just want to use it in your specific project:

```bash
npm install http-server
```

You should see your folder structure get updated to the following if setting up just for this project:

```md
myServer
â”œâ”€â”€ node_modules
â”œâ”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
```

Alternatively, you can install the dependency _globally_ using the `-g` flag:

```bash
npm install -g http-server
```

## Troubleshooting

If you do not automatically get the `package.json`, you will have to add it manually and fill the file with an "empty" json object:

```json
// package.json
{}
```

Try rerunning the `npm install <dependency>` command and you should see the following in your `package.json` now:

```json
{
  "dependencies": {
    "http-server": "^14.1.1" // could be another version tho
  }
}
```

## Using http-server

Open up your `package.json` and add the following:

```json
// package.json
{
  "scripts": {
    "start": "http-server"
  }
  // other stuff
}
```

To run your script, open the terminal and run the command:

```bash
npm run start
```

You should see the following appear if all went well:

```bash
Available on:
  http://127.0.0.1:8080
  http://192.168.0.10:8080
Hit CTRL-C to stop the server
```

If you installed `http-server` with the global `-g` flag, then all you need to do to start the server is simply with this command

```bash
http-server
```

# Static Sites && Content

Now that we have our static site up and running, lets add some high res content :^)

## Folder structure

Create a `public` directory. In here we are going to add high res images that are `public`ly accessible

```md
myServer
â”œâ”€â”€ public
â”œâ”€â”€ node_modules
â”œâ”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
```

## Getting Content

Head over to [Unsplash.com](https://unsplash.com/). This website lets you get high quality stock images for free. It's a tool I have been using to create websites, presentations, and marketing materials for my entire professional life.

## Importing Content

Add a high-res image to your `public` directory and import it in your `index.html` file comme ca:

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cool Cats</title>
  </head>
  <body>
    <img src="./public/cat.jpg" alt="cool cat" />
  </body>
</html>
```

However depending on how high quality the image is, it might take a moment to load the picture. You can specify the attribute to be `loading="lazy"` to improve your page performance.

## Exercise 2

In the same groups as exercise 1, setup a server using `http-server` and let the entry point of your server be `index.html`. Find 3 hi-res images from the internet and add them in a `public` folder

How long does it take to load your page using `loading="lazy"` on the images? What happens when this attribute is not present? What happens when you slow the network down to `Slow 4G` using Chrome DevTools?

```md
| Wifi    | Page Load time - Regular (ms) | Page Load time - Lazy (ms) |
| ------- | ----------------------------- | -------------------------- |
| Online  |                               |                            |
| Slow 4G |                               |                            |
```

## Solution

Your folder structure should look like:

```md
myServer
â”œâ”€â”€ public
â”‚ â”œâ”€â”€ image1
â”‚ â”œâ”€â”€ image2
â”‚ â”œâ”€â”€ image3
â”œâ”€â”€ node_modules
â”œâ”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
```

With your index.html containing:

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cool Cats</title>
  </head>
  <body>
    <img src="./public/image1.jpg" loading="lazy" />
    <img src="./public/image2.jpg" loading="lazy" />
    <img src="./public/image3.jpg" loading="lazy" />
  </body>
</html>
```

Then by navigating to the `Network` Tab, look for your `localhost` and take note of the load time in each scenario :^)
