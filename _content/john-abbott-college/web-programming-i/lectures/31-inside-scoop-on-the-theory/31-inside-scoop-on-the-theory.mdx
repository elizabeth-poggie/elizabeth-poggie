---
# General Information
category: "Web Programming I"
title: "Inside Scoop on the Theory"
created: "2024-11-04"
number: 31
---

# JSON continued

We covered JSON at a high level in previous classes, today we cover it in greater detail

## What is it?

- A standard text-based format for representing structured data that's _very_ popular
- It's based on JavaScript object syntax, but it is independent of JavaScript (could be used anywhere)

## When do we use it?

- It's often used to transfer data from web server to browser (client).
- When we transfer it, it is represented as a string because that's great for transfer.

## How do we make sure JavaScript is happy when dealing with JSON?

JavaScript provides a JSON object with methods to convert it to a JavaScript object.

# JSON vs JavaScript

## JSON data types

In JSON, values must be one of the following data types:

- a string (e.g. `"Don't Panic"`)
- a number (e.g. `42`)
- an object (e.g. JSON object)
- an array (e.g. `[stuff]`)
- a boolean (e.g. `true`/ `false`)
- `null` (angry user defined error)

## JavaScript data types

In JavaScript values can be all of the above, plus any other valid JavaScript expression, including:

- a function (e.g. `() => stuff`)
- a date
- `undefined` (angry JavaScript defined error)

## Examples

JSON Syntax:

```json
{
  "name": "Arthur Dent",
  "age": 42,
  "isPanicking": false,
  "items": ["blanket", "towel", "coffee"],
  "spaceship": null
}
```

Fun fact with the [autoformatter](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) when you assign this object to a constant will immediately turn it into a JavaScript object :^)

JavaScript Object Syntax:

```js
// you cant put comments in a json file
const arthur = {
  name: "Arthur Dent",
  age: 42,
  isPanicking: false,
  items: ["blanket", "towel", "coffee"],
  spaceship: undefined, // JSON doesn't support undefined lol
  panic() {
    this.isPanicking = true;
    console.log("AHHHHHHH");
  },
};
```

## Key differences

JSON requires _double_ quotes to be used around _property names_ and _values_ that are strings (unlike in JavaScript). Single quotes are not valid.

Even a single misplaced comma or colon can cause a JSON file to go wrong. (which is always lovely when it happens)

# Converting and Parsing JSON

Sometimes we want to receive JSON from a server and sometimes we are the server that wants to send JSON.

## Examples

JavaScript object => JSON

```js
const jsonString = JSON.stringify(arthur);
console.log(jsonString); // notice how some previously defined properties disappear
```

JSON => JavaScript object

```js
const processedArthur = JSON.parse(jsonString);
console.log(processedArthur);
```

# Usage and Best Practices

## Response.json()

Remember this example from yesterday?

```js
const response = await fetch(url);
const json = await response.json();
```

`response.json()` in JavaScript automatically parses the JSON for you, so you don't need to use `JSON.parse()` on the result.

## localStorage / sessionStorage

Data stored in localStorage or sessionStorage is stored as a string, so when we retrieve it, we need to parse it into an object to work with it.

```js
// Saving Arthur to localStorage
localStorage.setItem("storedArthur", JSON.stringify(arthur));

// Retrieving Arthur and parsing him
const storedArthur = localStorage.getItem("storedArthur");
const parsedArthur = JSON.parse(storedArthur);
console.log(parsedArthur); // notice which attributes are missing
```

## XMLHttpRequests

If youâ€™re getting data using `XMLHttpRequest`, youâ€™ll need to use `JSON.parse()` to handle the response:

```js
// init request
const xhr = new XMLHttpRequest();
// GET ditto
xhr.open("GET", "https://pokeapi.co/api/v2/pokemon/ditto");
// create handler
xhr.onload = function () {
  // ensure status is ok
  if (xhr.status === 200) {
    // Manually parse the JSON
    const data = JSON.parse(xhr.responseText);
    // log data
    console.log(data);
  }
};
// yeet request
xhr.send();
```

## Obscure APIs

Most modern APIs handle JSON parsing with `response.json()`, HOWEVER if you encounter APIs or libraries that unfortunately return a raw JSON string, so you gotta use `JSON.parse()`

# Exercise 1

Create a user object that holds your player's stats, then save this object to `localStorage`. After that, retrieve the stats from `localStorage` and log them to the console.

Food for thought: How would you check what's currently stored in `localStorage`?

## Solution

```js
const player = {
  name: "ReadyPlayerOne",
  level: 5,
  experience: 1200,
  health: 100,
  inventory: ["big stick", "towel", "will power"],
};

localStorage.setItem("playerStats", JSON.stringify(player));
const storedUser = JSON.parse(localStorage.getItem("playerStats"));

console.log(storedUser);
```

# Local Storage / Session Storage side tangent

ðŸ’¡ Note: I won't test you on this storage stuff, however adding this section for the curious

`localStorage` and `sessionStorage` are both types of web storage provided by the browser that allow you to store data in a mini-database within your browser. The stuff we save here usually doesn't get saved to the server!!

## Local Storage

Data saved in `localStorage` is persistent and remains there even after the user closes the browser or restarts their device. There is a limit to this btw, the capacity is limited to around 5-10 MB

## Session Storage

Data stored in `sessionStorage` is temporary and only lasts for the duration of the browser session. Has a similar capacity to `localStorage`

## How does this differ from cookies?

Cookies can be set to expire at a specific date and time, or they can deleted when the session ends. Their capacity is at 4 KB per cookie which is much smaller than the above storage options.

## How come so many companies want you to accept their cookie policy?

Cookies are accessible to both the client AND the server. `localStorage` and `sessionStorage` however are both only accessible _on the client side_, meaning that it's a secret to the server. How else will companies be able to steal your data?

When you don't have to pay for a product, you are the product :^) stay safe out there kids

# defer / async

The `defer` and `async` attributes in `<script>` tags impact how JavaScript files load and execute, affecting page load time and user experience.

More info: https://javascript.info/script-async-defer

## Standard - The OG

When you include a script without `async` or `defer`, yhe browser pauses HTML parsing to download and execute the script immediately once it reaches the `<script>` tag. Remember how I said to add your script tag at the end of your body? This is how we ensure the page loads before the script loads.

```html
<script src="./scripts/cool-script.js"></script>
```

## Defer

A cleaner way to get around the immediacy of the OG script tag is the `defer`. With this added to your script tag, the script starts downloading in the background while the HTML continues parsing.

Why is this so neat? The script waits until the entire HTML document is parsed, then executes in the order it appears in the DOM.

```html
<script defer src="./scripts/cool-script.js"></script>
```

## Async

Alternatively, when you add `async` to a script, the script downloads in the background without blocking HTML parsing. HOWEVER, the script executes as soon as itâ€™s ready, _potentially before the HTML document finishes parsing_.

```html
<script async src="./scripts/cool-script.js"></script>
```

When do I use what?

## Generally Speaking

- OG `script` tag ðŸ‘‰ Critical scripts that must run immediately, but rarely recommended unless you are in an intro to JS class and we are slowly learning different concepts
- `defer` attribute ðŸ‘‰ Scripts that need the "DOM ready" (e.g. anything that access the DOM)
- `async` attribute ðŸ‘‰ Independent scripts (e.g., analytics, ads)

# Page Load Impact

Let's take a closer look at the impact on the page load when choosing to go with a particular attribute:

![demo](./assets/1.png)

## Defer

![demo](./assets/4.png)

load file in background (get it from server) run js code only when DOM is ready (can retrieve HTML Element object in script)

```html
<script defer src="myFile.js"></script>
```

## Async

![demo](./assets/3.png)

load file in background (get it from server) run js code as soon as file loaded.
(DOM might not be ready)

```html
<script async src="myFile.js"></script>
```

## The OG

![demo](./assets/2.png)

load file right away (block rest of page) run js code as soon as file loaded.
(DOM might not be ready)

```html
<script src="myFile.js"></script>
```

## Docs

You can refer to [here](https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html#script) for a really solid

# DOMContentLoaded Checks and Usage

## With Defer

When working with `defer`, the browser loads the script in the background and executes it after the HTML parsing is complete. This means you typically donâ€™t need a `DOMContentLoaded` check. HOWEVER, for those that used this in assignment 2 without understanding it means that you need to take time to understand the fundamentals ðŸ‘€

When is it best to use it? Use `defer` for scripts that interact with the DOM. You can skip readiness checks unless you want to ensure other resources (like images) have also loaded, in which case you might use `window.onload`. TLDR: `defer` scripts are _guaranteed to execute in order_.

## With Async

When working with `async`, scripts load independently and execute as soon as theyâ€™re downloaded, which could happen before the DOM is fully loaded. THEREFORE, if your script needs to manipulate the DOM, youâ€™ll need a `DOMContentLoaded` check.

When is it best to use it? When you donâ€™t need to depend on the DOM or other scripts at all. Sometimes you need a script only for _server-side operations_ or for handling cache or cookies, but not for DOM manipulations.

# Friday Quiz

Focus on Ajax and the differences between traditional promises vs modern promises

# setTimeout function

takes in two parameters:
The function to run after the specified time. The function takes no parameters.
The specified time in ms.
