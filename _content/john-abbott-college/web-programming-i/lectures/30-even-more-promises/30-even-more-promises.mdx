---
# General Information
category: "Web Programming I"
title: "Even More Promises"
created: "2024-11-04"
number: 30
---

# Promise.all()

With traditional promises, sharing resolved values across multiple steps in the chain could be tricky. `async` and `await` simplifies that. HOWEVER, we still want to run multiple asynchronous tasks at the same time, _especially if they're not dependent on each other_. This is why we love `Promise.all`

## Common failures

Only await tasks sequentially if they depend on each otherâ€™s results. If theyâ€™re _independent_, you can use `Promise.all` to run them "concurrently" (e.g. at the same time)

For example, let's say I have the following `async` function:

```js
// simple function
const getIngredient = async (name) => {
  // walk to kitchen delay
  await new Promise((resolve) => setTimeout(resolve, 1500));
  // return ingredient
  return Promise.resolve(name);
};
```

Now, hereâ€™s a function that uses this to make a sandwich:

```js
const badSandwich = async () => {
  const ing1 = await getIngredient("bread");
  const ing2 = await getIngredient("peanut butter");
  const ing3 = await getIngredient("jelly");
  return [ing1, ing2, ing3, ing1]; // ðŸ¥ª
};
```

To make a sandwich:

```js
try {
  const food = await badSandwich();
  console.log(food);
} catch (error) {
  console.log(error.message);
}
```

However, this is a `badSandwich` because each ingredient waits for the previous one. Letâ€™s make a `betterSandwich` using `Promise.all`:

```js
const betterSandwich = async () => {
  const [ing1, ing2, ing3] = await Promise.all([
    getIngredient("bread"),
    getIngredient("peanut butter"),
    getIngredient("jelly"),
  ]);
  return [ing1, ing2, ing3, ing1]; // ðŸ¥ª
};
```

Using `Promise.all` allows us to get each ingredient "concurrently", which makes the code faster and more efficient. In `betterSandwich` weâ€™re taking full advantage of _non-blocking code_ and using the event loop effectively :^)

Why is this technique so handy? Let's take a look at the real world application

# Real World Application

Let's take what we know about `fetch`ing data from an API and do this elegantly with `async` and await

For example, let's `fetch` a bunch of pokemons concurrently with the following syntax:

```js
const urls = [
  "https://pokeapi.co/api/v2/pokemon/ditto",
  "https://pokeapi.co/api/v2/pokemon/pikachu",
  "https://pokeapi.co/api/v2/pokemon/squirtle",
];

// Step 1 - create a bunch of pokemon promises
const pokemonPromises = urls.map(async (url) => {
  const response = await fetch(url);
  // I am returning a PROMISE of JSON not actually JSON
  return response.json();
});

// Step 2 - resolve promises all at once
console.log(await Promise.all(pokemonPromises));
```

## Alternative strategy

However let's say we wanted to fetch the data one at a time for various reasons. In this case, you need to be careful when you use `async` and `await` when working with `map` and `forEach`. It wont actually pause the function in this context:

```js
const pokemonPromises = urls.map(async (url) => {
  // not being paused like you may think
  const response = await fetch(url);
  return response.json();
});

// everything concurrently
console.log(await Promise.all(pokemonPromises));
```

Alternatively, if you want stuff to happen one at a time instead of concurrently, you can use the following syntax:

```js
const pokemons = [];

const pokemonLoop = async () => {
  // fetching one thing at a time
  for await (const url of urls) {
    const response = await fetch(url);
    const pokemon = await response.json();
    pokemons.push(pokemon);
  }
};

// resolve the loop
await pokemonLoop();

console.log(pokemons);
```

## (not so) Fun Fact

async/await is the industry standard :^)

# Exercise 1

Using what you know about `fetch`, try to call the Pokemon API to `fetch` 5 pokemon's `id` using the `async` / `await`, `Promise.all`, and this endpoint:

```text
https://pokeapi.co/api/v2/pokemon/{name}
```

Then once you get the `id`, use the following endpoint to `fetch` their Pokeathlon stats:

```text
https://pokeapi.co/api/v2/pokeathlon-stat/{id}/
```
